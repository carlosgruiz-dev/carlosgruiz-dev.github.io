<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Haskell Simple HTTP Server | Carlos Gustavo Ruiz</title>
<meta name=keywords content="lab,haskell,open source,english">
<meta name=description content="I&rsquo;m pushing myself to learn Haskell, but I realized that the best way to learn is
to make things, broke them and build them again. So I decided to start a toy
project to create a substitute for commands like $ python3 -m http.server or
$ php -S 0.0.0.0:8000 that fires a simple HTTP server to look your HTML files.
For this, I have a twitter thread
to log me and avoid procrastination.">
<meta name=author content>
<link rel=canonical href=https://carlosgustavoruiz.me/blog/haskell-simple-http-server/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://carlosgustavoruiz.me/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://carlosgustavoruiz.me/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://carlosgustavoruiz.me/favicon-32x32.png>
<link rel=apple-touch-icon href=https://carlosgustavoruiz.me/apple-touch-icon.png>
<link rel=mask-icon href=https://carlosgustavoruiz.me/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Haskell Simple HTTP Server">
<meta property="og:description" content="I&rsquo;m pushing myself to learn Haskell, but I realized that the best way to learn is
to make things, broke them and build them again. So I decided to start a toy
project to create a substitute for commands like $ python3 -m http.server or
$ php -S 0.0.0.0:8000 that fires a simple HTTP server to look your HTML files.
For this, I have a twitter thread
to log me and avoid procrastination.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://carlosgustavoruiz.me/blog/haskell-simple-http-server/"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2017-08-20T19:00:24-05:00">
<meta property="article:modified_time" content="2017-08-20T20:00:00-05:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Haskell Simple HTTP Server">
<meta name=twitter:description content="I&rsquo;m pushing myself to learn Haskell, but I realized that the best way to learn is
to make things, broke them and build them again. So I decided to start a toy
project to create a substitute for commands like $ python3 -m http.server or
$ php -S 0.0.0.0:8000 that fires a simple HTTP server to look your HTML files.
For this, I have a twitter thread
to log me and avoid procrastination.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://carlosgustavoruiz.me/blog/"},{"@type":"ListItem","position":2,"name":"Haskell Simple HTTP Server","item":"https://carlosgustavoruiz.me/blog/haskell-simple-http-server/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Haskell Simple HTTP Server","name":"Haskell Simple HTTP Server","description":"I\u0026rsquo;m pushing myself to learn Haskell, but I realized that the best way to learn is to make things, broke them and build them again. So I decided to start a toy project to create a substitute for commands like $ python3 -m http.server or $ php -S 0.0.0.0:8000 that fires a simple HTTP server to look your HTML files. For this, I have a twitter thread to log me and avoid procrastination.\n","keywords":["lab","haskell","open source","english"],"articleBody":"I’m pushing myself to learn Haskell, but I realized that the best way to learn is to make things, broke them and build them again. So I decided to start a toy project to create a substitute for commands like $ python3 -m http.server or $ php -S 0.0.0.0:8000 that fires a simple HTTP server to look your HTML files. For this, I have a twitter thread to log me and avoid procrastination.\nTo meet my goal, I must find a way to work with a web server like in other programming languages or better. Let’s find out what we can do for this.\nReference Implementation So, let’s start with a reference implementation, and since JavaScript is widely in use this could be a good idea. On NodeJS we can walk through this with this snippet:\n It’s self-explaining, we call for a module (line 1), define a server (lines 2-7) and start the server (line 8). For the project this is the kind of things I will like to do rather than going too low-level programming.\nUsing Sockets For any project, we need a bit of research looking for options of how to do what we want, the Haskell Wiki has a page with a reference for creating Simple Servers, plus it is in a concurrent fashion.\n Since we are using sockets (line 5 withSocketsDo) it’s clear that its lower level programming in comparison with our JavaScript reference. If you still have doubts just see the line 15, and this string \"HTTP/1.0 200\\r\\nContent-Length: 13\\r\\n\\r\\nHello, World!\\r\\n\" rings the low-level programming bell again.\nNothing bad with this kind of fine grain control, but is not the abstraction level I’m looking for. Anyway, it is worth to take a look at this example because even using sockets and other low-level abstraction resources Haskell still is a very expressive and concise.\nUsing Wai Some more googling and I found Wai, a package of the Yesod framework. This is pretty much is what I expect to use for my project. To be honest this code and the reference one maybe are oversimplifications, but still, give us valuable information about how our application is going to deal with the web server.\n To build this example you need to install two packages, since I use Haskell Stack you can do it writing:\n$ stack install wai warp or:\n$ cabal install wai warp if you use the cabal build tool.\nA quick and dirty explanation of this code is, a language pragma to make strings polymorphic (line 1), imports for modules and specific functions (lines 2-4), a function definition for the application (lines 6-7) and finally a call for that function at the main entry point.\nAnd this is all for now, hope you find this post useful.\n Credits for the plane blueprints image to the Bureau of Aeronautics, U.S. Navy  ","wordCount":"474","inLanguage":"en","datePublished":"2017-08-20T19:00:24-05:00","dateModified":"2017-08-20T20:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://carlosgustavoruiz.me/blog/haskell-simple-http-server/"},"publisher":{"@type":"Organization","name":"Carlos Gustavo Ruiz","logo":{"@type":"ImageObject","url":"https://carlosgustavoruiz.me/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://carlosgustavoruiz.me/ accesskey=h title="Carlos Gustavo Ruiz (Alt + H)">Carlos Gustavo Ruiz</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://carlosgustavoruiz.me/blog/ title=blog>
<span>blog</span>
</a>
</li>
<li>
<a href=https://github.com/carlosgruiz-dev/carlosgruiz-dev/wiki title=wiki>
<span>wiki</span>
</a>
</li>
<li>
<a href=https://carlosgustavoruiz.me/talks/ title=talks>
<span>talks</span>
</a>
</li>
<li>
<a href=https://carlosgustavoruiz.me/bookmarks/ title=bookmarks>
<span>bookmarks</span>
</a>
</li>
<li>
<a href=https://carlosgustavoruiz.me/now/ title=now>
<span>now</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Haskell Simple HTTP Server
</h1>
<div class=post-meta><span title="2017-08-20 19:00:24 -0500 -0500">August 20, 2017</span>
</div>
</header>
<div class=post-content><p>I&rsquo;m pushing myself to learn Haskell, but I realized that the best way to learn is
to make things, broke them and build them again. So I decided to start a toy
project to create a substitute for commands like <code>$ python3 -m http.server</code> or
<code>$ php -S 0.0.0.0:8000</code> that fires a simple HTTP server to look your HTML files.
For this, I have a <a href=https://twitter.com/atmantree/status/897987573024399361>twitter thread</a>
to log me and avoid procrastination.</p>
<p><img loading=lazy src=/images/plane-blueprint.png alt="Plane Blueprint">
</p>
<p>To meet my goal, I must find a way to work with a web server like in other
programming languages or better. Let&rsquo;s find out what we can do for this.</p>
<h2 id=reference-implementation>Reference Implementation<a hidden class=anchor aria-hidden=true href=#reference-implementation>#</a></h2>
<p>So, let&rsquo;s start with a reference implementation, and since JavaScript is widely in
use this could be a good idea. On <a href=https://nodejs.org/>NodeJS</a> we can walk through
this with this snippet:</p>
<script src=https://gist.github.com/atmantree/effb9afcf5c82399a609ad622fc99a61.js></script>
<p>It&rsquo;s self-explaining, we call for a module <em>(line 1)</em>, define a server <em>(lines 2-7)</em>
and start the server <em>(line 8)</em>. For the project this is the kind of things I will
like to do rather than going too low-level programming.</p>
<h2 id=using-sockets>Using Sockets<a hidden class=anchor aria-hidden=true href=#using-sockets>#</a></h2>
<p>For any project, we need a bit of research looking for options of how to do what we
want, the <a href=https://wiki.haskell.org/>Haskell Wiki</a> has a page with a reference for
creating <a href=https://wiki.haskell.org/Simple_Servers>Simple Servers</a>, plus it is in a
concurrent fashion.</p>
<script src=https://gist.github.com/atmantree/214d3da2f2814dfe3edaa8ae42b51bd0.js></script>
<p>Since we are using sockets
<em>(line 5 <a href=http://hackage.haskell.org/package/network-2.6.3.2/docs/Network-Socket-Internal.html#v:withSocketsDo>withSocketsDo</a>)</em>
it&rsquo;s clear that its lower level programming in comparison with our JavaScript reference.
If you still have doubts just see the <em>line 15</em>, and this string
<code>"HTTP/1.0 200\r\nContent-Length: 13\r\n\r\nHello, World!\r\n"</code> rings the low-level
programming bell again.</p>
<p>Nothing bad with this kind of fine grain control, but is not the abstraction level
I&rsquo;m looking for. Anyway, it is worth to take a look at this example because even using
sockets and other low-level abstraction resources Haskell still is a very expressive
and concise.</p>
<h2 id=using-wai>Using Wai<a hidden class=anchor aria-hidden=true href=#using-wai>#</a></h2>
<p>Some more googling and I found <a href=https://github.com/yesodweb/wai>Wai</a>, a package of
the <a href=http://www.yesodweb.com/>Yesod</a> framework. This is pretty much is what I
expect to use for my project. To be honest this code and the reference one maybe
are oversimplifications, but still, give us valuable information about how our
application is going to deal with the web server.</p>
<script src=https://gist.github.com/atmantree/ba6ba743b5f1e35e089b9227cf41009f.js></script>
<p>To build this example you need to install two packages, since I use
<a href=https://haskellstack.org>Haskell Stack</a> you can do it writing:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ stack install wai warp
</code></pre></div><p>or:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cabal install wai warp
</code></pre></div><p>if you use the <a href=https://www.haskell.org/cabal/>cabal</a> build tool.</p>
<p>A quick and dirty explanation of this code is, a language pragma to make strings
polymorphic <em>(line 1)</em>, imports for modules and specific functions <em>(lines 2-4)</em>,
a function definition for the application <em>(lines 6-7)</em> and finally a call for that
function at the <code>main</code> entry point.</p>
<p>And this is all for now, hope you find this post useful.</p>
<hr>
<small>Credits for the plane blueprints image to the
<a href=https://commons.wikimedia.org/wiki/File:General_Motors_TBM-3S_Avenger_3-side-view_Blueprint.png>
Bureau of Aeronautics, U.S. Navy
</a>
</small>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://carlosgustavoruiz.me/tags/lab/>lab</a></li>
<li><a href=https://carlosgustavoruiz.me/tags/haskell/>haskell</a></li>
<li><a href=https://carlosgustavoruiz.me/tags/open-source/>open source</a></li>
<li><a href=https://carlosgustavoruiz.me/tags/english/>english</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://carlosgustavoruiz.me/>Carlos Gustavo Ruiz</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>